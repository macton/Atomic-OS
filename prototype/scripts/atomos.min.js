// firebug-compatible dummy console for browsers without one
// api derived from http://getfirebug.com/wiki/index.php/Console_API
function TclInterp(){function sec_msec(){var a=new Date;return a.getSeconds()*1e3+a.getMilliseconds()}this.callframe=new Array(new Object),this.level=0,this.commands=new Object,this.procs=new Array,this.OK=0,this.RET=1,this.BRK=2,this.CNT=3,this.getVar=function(a){var b=a.toString();if(b.match("^::"))var c=this.callframe[0][b.substr(2)];else var c=this.callframe[this.level][a];if(c==null)throw"No such variable: "+a;return c},this.setVar=function(a,b){var c=a.toString();return c.match("^::")?this.callframe[0][c.substr(2)]=b:this.callframe[this.level][a]=b,b},this.incrLevel=function(){return this.callframe[++this.level]=new Object,this.level},this.decrLevel=function(){this.callframe[this.level]=null,this.level--;if(this.level<0)throw"Exit application";this.result=null},this.getCommand=function(a){try{return this.commands[a]}catch(b){throw"No such command '"+a+"'"}},this.registerCommand=function(a,b,c){if(b==null)throw"No such function: "+a;this.commands[a]=new TclCommand(b,c)},this.renameCommand=function(a,b){this.commands[b]=this.commands[a],this.procs[a]&&(this.procs[a]=null,this.procs[b]=!0),this.commands[a]=null},this.registerSubCommand=function(a,b,c,d){if(c==null)throw"No such subcommand: "+a+" "+b;var e=a.split(" "),f;a=e.shift();var g=this.commands[a];g==null&&(f=new Object,f.subcommands=new TclCommand(Tcl.InfoSubcommands,null),this.commands[a]=new TclCommand(Tcl.EnsembleCommand,null,f)),f=this.commands[a].ensemble;if(f==null)throw"Not an ensemble command: '"+a+"'";while(e.length>0)a=e.shift(),g=f[a],g==null&&(g=new TclCommand(Tcl.EnsembleCommand,null,new Object),f[a]=g,f=g.ensemble,f.subcommands=new TclCommand(Tcl.InfoSubcommands,null));f[b]=new TclCommand(c,d)},this.eval=function(a){try{return this.eval2(a)}catch(b){throw b}},this.eval2=function(a){this.code=this.OK;var b=new TclParser(a),c=new Array(0),d=!0,e,f,g;g="";for(;;){f=b.type;try{b.getToken()}catch(h){break}if(b.type==b.EOF)break;e=b.getText();if(b.type==b.VAR)try{e=this.getVar(e)}catch(h){throw"No such variable '"+e+"'"}else if(b.type==b.CMD)try{e=this.eval2(e)}catch(h){throw h+'\nwhile parsing "'+e+'"'}else if(b.type!=b.ESC&&b.type==b.SEP){f=b.type;continue}e=this.objectify(e);if(b.type==b.EOL||b.type==b.EOF){f=b.type;if(c.length>0){g=this.call(c);if(this.code!=this.OK)return this.objectify(g)}c=new Array;continue}f==b.SEP||f==b.EOL?c.push(e):c[c.length-1]=c[c.length-1].toString()+e.toString()}return c.length>0&&(g=this.call(c)),this.objectify(g)},this.registerCommand("and",function(a,b){this.requireExactArgc(b,3);var c=a.objectify(b[1]).toBoolean(),d=a.objectify(b[2]).toBoolean();return c&&d}),this.registerCommand("append",function(a,b){this.requireMinArgc(b,2);var c=b[1].toString();if(a.callframe[a.level][c]!=null)var d=a.getVar(c);else var d="";for(var e=2;e<b.length;e++)d+=b[e].toString();return a.setVar(c,d),d}),this.registerCommand("break",function(a,b){a.code=a.BRK;return}),this.registerCommand("continue",function(a,b){a.code=a.CNT;return}),this.registerSubCommand("clock","format",function(a,b){var c=new Date;return c.setTime(b[1]),c.toString()}),this.registerSubCommand("clock","scan",function(a,b){return Date.parse(b[1])}),this.registerSubCommand("clock","seconds",function(a,b){return(new Date).valueOf()});if(typeof jQuery!="undefined"||typeof Zepto!="undefined")console.log("Tcl found jQuery or Zepto during startup, registering dom command"),this.registerCommand("dom",function(a,b){var c=b[1].toString(),d=b[2].toString();b=b.slice(3);for(var e in b)b[e]=b[e].toString();var f=$(c);return f[d].apply(f,b),"dom  "+c});this.registerCommand("eval",function(a,b){this.requireMinArgc(b,2);for(var c=1;c<b.length;c++)b[c]=b[c].toString();if(b.length==2)var d=b[1];else var d=b.slice(1).join(" ");return a.eval(d)}),sqrt=Math.sqrt,this.registerCommand("expr",function(interp,args){return eval(args[1].toString())}),this.registerCommand("for",function(a,b){this.requireExactArgc(b,5),a.eval(b[1].toString());if(a.code!=a.OK)return;var c="set _ "+b[2].toString(),d=b[3].toString(),e=b[4].toString();a.inLoop=!0,a.code=a.OK;for(;;){test=a.objectify(a.eval(c));if(!test.toBoolean())break;a.eval(e);var f=a.code;a.eval(d);if(f==a.BRK)break;if(f==a.CNT)continue}a.inLoop=!1;if(a.code==a.BRK||a.code==a.CNT)a.code=a.OK;return""}),this.registerCommand("foreach",function(a,b){this.requireExactArgc(b,4);var c=b[2].toList(),d=b[3].toString(),e="";a.inLoop=!0,a.code=a.OK;for(i in c){a.setVar(b[1],a.objectify(c[i])),a.eval(d);if(a.code==a.BRK)break;if(a.code==a.CNT)continue}a.inLoop=!1;if(a.code==a.BRK||a.code==a.CNT)a.code=a.OK;return""}),this.registerCommand("gets",function(a,b){this.requireArgcRange(b,2,3);var c=prompt(b[1],"");return b[2]!=null?(a.setVar(b[2],a.objectify(c)),c.length):c}),this.registerCommand("if",function(a,b){this.requireMinArgc(b,3);var c=a.objectify(a.eval("set _ "+b[1].toString()));if(c.toBoolean())return a.eval(b[2].toString());if(b.length==3)return;for(var d=3;d<b.length;)switch(b[d].toString()){case"else":return this.requireExactArgc(b,d+2),a.eval(b[d+1].toString());case"elseif":this.requireMinArgc(b,d+3),c=a.objectify(a.eval("set _ "+b[d+1].toString()));if(c.toBoolean())return a.eval(b[d+2].toString());d+=3;break;default:throw"Expected 'else' or 'elseif', got "+b[d]}}),this.registerCommand("incr",function(a,b){this.requireArgcRange(b,2,3);var c=b[1];if(b.length==2)var d=1;else var d=a.objectify(b[2]).toInteger();return d+=a.getVar(c).toInteger(),a.setVar(c,new TclObject(d,"INTEGER"))}),this.registerSubCommand("info","body",function(a,b){this.requireExactArgc(b,2);var c=b[1].toString();if(!a.procs[c])throw"Not a procedure: "+c;return a.getCommand(c).privdata[1]}),this.registerSubCommand("info","commands",function(a,b){return a.mkList(a.commands)}),this.registerSubCommand("info","globals",function(a,b){return a.mkList(a.callframe[0])}),this.registerSubCommand("info","isensemble",function(a,b){this.requireExactArgc(b,2);var c=b[1].toString();return a.getCommand(c).ensemble!=null}),this.registerSubCommand("info","procs",function(a,b){return a.mkList(a.procs)}),this.registerSubCommand("info","vars",function(a,b){return a.mkList(a.callframe[a.level])}),this.registerCommand("jseval",function(interp,args){return eval(args[1].toString())}),this.registerCommand("lappend",function(a,b){this.requireMinArgc(b,2);var c=b[1].toString();if(a.callframe[a.level][c]!=null)var d=a.getVar(c);else var d=new TclObject([]);d.toList();for(var e=2;e<b.length;e++)d.content.push(a.objectify(b[e]));return a.setVar(c,d),d}),this.registerCommand("lindex",function(a,b){this.requireMinArgc(b,3);var c=a.objectify(b[1]);for(var d=2;d<b.length;d++){try{var e=c.listIndex(b[d])}catch(f){if(f=="Index out of bounds")return"";throw f}c=c.content[e]}return a.objectify(c)}),this.registerCommand("list",function(a,b){return b.shift(),new TclObject(b)}),this.registerCommand("llength",function(a,b){return this.requireExactArgc(b,2),b[1].toList().length}),this.registerCommand("lrange",function(a,b){this.requireExactArgc(b,4);var c=a.objectify(b[1]),d=c.listIndex(b[2]),e=c.listIndex(b[3])+1;try{return c.content.slice(d,e)}catch(f){return new Array}}),this.registerCommand("lset",function(a,b){this.requireMinArgc(b,4);var c=a.getVar(b[1].toString()),d=c;for(var e=2;e<b.length-2;e++)d.toList(),d=a.objectify(d.content[d.listIndex(b[e])]);return d.toList(),e=b.length-2,d.content[d.listIndex(b[e])]=a.objectify(b[e+1]),c}),this.registerCommand("lsort",function(a,b){return this.requireExactArgc(b,2),b[1].toList().sort()}),this.registerCommand("not",function(a,b){return this.requireExactArgc(b,2),!a.objectify(b[1]).toBoolean()}),this.registerCommand("or",function(a,b){this.requireExactArgc(b,3);var c=a.objectify(b[1]).toBoolean(),d=a.objectify(b[2]).toBoolean();return c||d}),this.registerCommand("puts",function(a,b){this.requireExactArgc(b,2),system.proc.wash.fd[1].write(b[1])}),this.registerCommand("proc",function(a,b){this.requireExactArgc(b,4);var c=b[1].toString(),d=a.parseList(b[2]),e=b[3].toString(),f=new Array(d,e);a.commands[c]=new TclCommand(Tcl.Proc,f),a.procs[c]=!0}),this.registerCommand("regexp",function(a,b){this.requireExactArgc(b,3);var c=new RegExp(b[1].toString()),d=b[2].toString();return d.search(c)>-1}),this.registerCommand("rename",function(a,b){this.requireExactArgc(b,3),a.renameCommand(b[1],b[2])}),this.registerCommand("return",function(a,b){this.requireArgcRange(b,1,2);var c=b[1];return a.code=a.RET,c}),this.registerCommand("set",function(a,b){this.requireArgcRange(b,2,3);var c=b[1];return b.length==3&&a.setVar(c,b[2]),a.getVar(c)}),this.registerCommand("source",function(a,b){return this.requireExactArgc(b,2),Tcl.Source(a,b[1])}),this.registerSubCommand("string","equal",function(a,b){return this.requireExactArgc(b,3),b[1].toString()==b[2].toString()}),this.registerSubCommand("string","index",function(a,b){this.requireExactArgc(b,3);var c=b[1].toString();try{return c.charAt(b[1].stringIndex(b[2]))}catch(d){return""}}),this.registerSubCommand("string","range",function(a,b){this.requireExactArgc(b,4);var c=b[1];try{var d=c.stringIndex(b[2].toString()),e=c.stringIndex(b[3].toString());return d>e?"":c.toString().substring(d,e+1)}catch(e){return""}}),this.registerCommand("time",function(a,b){this.requireArgcRange(b,2,3);if(b.length==3)var c=b[2];else var c=1;var d=sec_msec();for(var e=0;e<c;e++)a.eval(b[1].toString());return(sec_msec()-d)*1e3/c+" microseconds per iteration"}),this.registerCommand("unset",function(a,b){this.requireExactArgc(b,2),a.setVar(b[1],null)}),this.registerCommand("while",function(a,b){this.requireExactArgc(b,3);var c="set _ "+b[1].toString(),d=b[2].toString(),e="";a.inLoop=!0,a.code=a.OK;for(;;){test=a.objectify(a.eval(c));if(!test.toBoolean())break;e=a.eval(d);if(a.code==a.CNT)continue;if(a.code!=a.OK)break}a.inLoop=!1;if(a.code==a.BRK||a.code==a.CNT)a.code=a.OK;return a.objectify(e)}),this.registerCommand("native",function(interp,args){this.requireExactArgc(args,3);var cmd=args[1].toList(),func=eval(args[2].toString());if(cmd.length==1){interp.registerCommand(cmd[0].toString(),func);return}base=cmd[0].toString(),cmd.shift(),interp.registerSubCommand(base,cmd.join(" "),eval(args[2].toString()));return}),this.math=function(a,b,c){switch(a){case"+":return b+c;case"-":return b-c;case"*":return b*c;case"/":return b/c;case"%":return b%c;case"<":return b<c;case">":return b>c;case"=":case"==":return b==c;case"!=":return b!=c;default:throw"Unknown operator: '"+a+"'"}};var ops=["+","-","*","/","%","<",">","=","==","!="];for(i in ops)this.registerCommand(ops[i],function(a,b){this.requireExactArgc(b,3);var c=b[0].toString(),d=a.objectify(b[1]),e=a.objectify(b[2]),f=d.getNumber(),g=e.getNumber();return d.isInteger()&&e.isInteger()?new TclObject(a.math(c,f,g),"INTEGER"):d.isReal()&&e.isReal()?new TclObject(a.math(c,f,g),"REAL"):new TclObject(a.math(c,f,g).toString())});this.mkList=function(a){var b=new Array;for(var c in a)b.push(c);return b},this.objectify=function(a){if(a==null)a="";else if(a instanceof TclObject)return a;return new TclObject(a)},this.parseString=function(a){a=a.toString();switch(a.charAt(0)+a.substr(a.length-1)){case"{}":case'""':a=a.substr(1,a.length-2)}return this.objectify(a)},this.parseList=function(a){a=a.toString();switch(a.charAt(0)+a.substr(a.length-1)){case"{}":case'""':a=new Array(a)}return this.objectify(a)},this.call=function(a){if(_step&&!confirm("this.call "+a))throw"user abort";var b=this.getCommand(a[0].toString()),c=b.call(this,a);switch(this.code){case this.OK:case this.RET:return c;case this.BRK:if(!this.inLoop)throw"Invoked break outside of a loop";break;case this.CNT:if(!this.inLoop)throw"Invoked continue outside of a loop";break;default:throw"Unknown return code "+this.code}return c},typeof jQuery!="undefined"&&this.eval("proc puts s {dom body appendTo \"<div style='font-family:Courier'>$s</div>\";list}")}function TclObject(a){this.TEXT=0,this.LIST=1,this.INTEGER=2,this.REAL=3,this.BOOL=4;switch(arguments[0]){case"LIST":case"INTEGER":case"REAL":case"BOOL":this.type=this[arguments[0]];break;default:this.type=this.TEXT,a instanceof Array?this.type=this.LIST:a=a.toString()}this.content=a,this.stringIndex=function(a){return this.toString(),this.index(a,this.content.length)},this.listIndex=function(a){return this.toList(),this.index(a,this.content.length)},this.index=function(a,b){var c=a.toString();c.substring(0,4)=="end-"?c=b-parseInt(c.substring(4))-1:c=="end"?c=b-1:c=parseInt(c);if(isNaN(c))throw"Bad index "+a;if(c<0||c>=b)throw"Index out of bounds";return c},this.isInteger=function(){return this.type==this.INTEGER},this.isReal=function(){return this.type==this.REAL},this.getString=function(a,b){var c=new Array;for(var d in a)c[d]=a[d].toString(),Tcl.isList.test(c[d])&&!Tcl.isNested.test(c[d])&&(c[d]="{"+c[d]+"}");return c.length==1?c[0]:c.join(" ")},this.toString=function(){return this.type!=this.TEXT&&(this.type==this.LIST?this.content=this.getString(this.content):this.content=this.content.toString(),this.type=this.TEXT),this.content},this.getList=function(a){a.charAt(0)=="{"&&a.charAt(a.length-1)=="}"&&(a=a.substring(1,a.length-1));if(a=="")return[];var b=new TclParser(a.toString()),c=new Array;for(var d=0;;d++){b.parseList(),c[d]=new TclObject(b.getText());if(b.type==b.EOL||b.type==b.ESC)break}return c},this.toList=function(){return this.type!=this.LIST&&(this.type!=this.TEXT?this.content[0]=this.content:this.content=this.getList(this.content),this.type=this.LIST),this.content},this.toInteger=function(){if(this.type==this.INTEGER)return this.content;this.toString();if(this.content.match(Tcl.isHex))this.content=parseInt(this.content.substring(2),16);else if(this.content.match(Tcl.isOctal))this.content=parseInt(this.content,8);else if(this.content.match(Tcl.isDecimal))this.content=parseInt(this.content);else throw"Not an integer: '"+this.content+"'";if(isNaN(this.content))throw"Not an integer: '"+this.content+"'";return this.type=this.INTEGER,this.content},this.getFloat=function(a){if(!a.toString().match(Tcl.isReal))throw"Not a real: '"+a+"'";return parseFloat(a)},this.toReal=function(){if(this.type==this.REAL)return this.content;this.toString(),this.content=this.getFloat(this.content);if(isNaN(this.content))throw"Not a real: '"+this.content+"'";return this.type=this.REAL,this.content},this.getNumber=function(){try{return this.toInteger()}catch(a){return this.toReal()}},this.toBoolean=function(){if(this.type==this.BOOL)return this.content;try{this.content=this.toInteger()!=0}catch(a){var b=this.content;if(b instanceof Boolean)return b;switch(b.toString().toLowerCase()){case"yes":case"true":case"on":this.content=!0;break;case"false":case"off":case"no":this.content=!1;break;default:throw"Boolean expected, got: '"+this.content+"'"}}return this.type=this.BOOL,this.content}}function TclCommand(a,b){if(a==null)throw"No such function";this.func=a,this.privdata=b,this.ensemble=arguments[2],this.call=function(a,b){var c=this.func(a,b);return c=a.objectify(c),c!=null&&a.setVar("_",c),c},this.requireExactArgc=function(a,b){if(a.length!=b)throw b+" arguments expected, got "+a.length},this.requireMinArgc=function(a,b){if(a.length<b)throw b+" arguments expected at least, got "+a.length},this.requireArgcRange=function(a,b,c){if(a.length<b||a.length>c)throw b+" to "+c+" arguments expected, got "+a.length}}function TclParser(a){this.OK=0,this.SEP=0,this.STR=1,this.EOL=2,this.EOF=3,this.ESC=4,this.CMD=5,this.VAR=6,this.text=a,this.start=0,this.end=0,this.insidequote=!1,this.index=0,this.len=a.length,this.type=this.EOL,this.cur=this.text.charAt(0),this.getText=function(){return this.text.substring(this.start,this.end+1)},this.parseString=function(){var a=this.type==this.SEP||this.type==this.EOL||this.type==this.STR;if(a&&this.cur=="{")return this.parseBrace();a&&this.cur=='"'&&(this.insidequote=!0,this.feedchar()),this.start=this.index;for(;;){if(this.len==0)return this.end=this.index-1,this.type=this.ESC,this.OK;if(this.cur=="\\")this.len>=2&&this.feedSequence();else if("$[ \t\n\r;".indexOf(this.cur)<0){if(this.cur=='"'&&this.insidequote)return this.end=this.index-1,this.type=this.ESC,this.feedchar(),this.insidequote=!1,this.OK}else if("$[".indexOf(this.cur)>=0||!this.insidequote)return this.end=this.index-1,this.type=this.ESC,this.OK;this.feedchar()}return this.OK},this.parseList=function(){level=0,this.start=this.index;for(;;){if(this.len==0){this.end=this.index,this.type=this.EOL;return}switch(this.cur){case"\\":this.len>=2&&this.feedSequence();break;case" ":case"\t":case"\n":case"\r":if(level>0)break;this.end=this.index-1,this.type=this.SEP,this.feedchar();return;case"{":level++;break;case"}":level--}this.feedchar()}if(level!=0)throw"Not a list";this.end=this.index;return},this.parseSep=function(){this.start=this.index;while(" \t\r\n".indexOf(this.cur)>=0)this.feedchar();return this.end=this.index-1,this.type=this.SEP,this.OK},this.parseEol=function(){this.start=this.index;while(" \t\n\r;".indexOf(this.cur)>=0)this.feedchar();return this.end=this.index-1,this.type=this.EOL,this.OK},this.parseCommand=function(){var a=1,b=0;this.feedcharstart();for(;;){if(this.len==0)break;if(this.cur=="["&&b==0)a++;else if(this.cur=="]"&&b==0){a--;if(a==0)break}else this.cur=="\\"?this.feedSequence():this.cur=="{"?b++:this.cur=="}"&&b!=0&&b--;this.feedchar()}return this.end=this.index-1,this.type=this.CMD,this.cur=="]"&&this.feedchar(),this.OK},this.parseVar=function(){return this.feedcharstart(),this.end=this.index+this.text.substring(this.index).match(Tcl.getVar).toString().length-1,this.end==this.index-1?(this.end=--this.index,this.type=this.STR):this.type=this.VAR,this.setPos(this.end+1),this.OK},this.parseBrace=function(){var a=1;this.feedcharstart();for(;;){if(this.len>1&&this.cur=="\\")this.feedSequence();else if(this.len==0||this.cur=="}"){a--;if(a==0||this.len==0)return this.end=this.index-1,this.len>0&&this.feedchar(),this.type=this.STR,this.OK}else this.cur=="{"&&a++;this.feedchar()}return this.OK},this.parseComment=function(){while(this.cur!="\n"&&this.cur!="\r")this.feedchar()},this.getToken=function(){for(;;){if(this.len==0)return this.type==this.EOL&&(this.type=this.EOF),this.type!=this.EOF&&(this.type=this.EOL),this.OK;switch(this.cur){case" ":case"\t":if(this.insidequote)return this.parseString();return this.parseSep();case"\n":case"\r":case";":if(this.insidequote)return this.parseString();return this.parseEol();case"[":return this.parseCommand();case"$":return this.parseVar()}if(this.cur=="#"&&this.type==this.EOL){this.parseComment();continue}return this.parseString()}return this.OK},this.feedSequence=function(){if(this.cur!="\\")throw"Invalid escape sequence";var a=this.steal(1),b=new Object;b.a="a",b.b="\b",b.f="\f",b.n="\n",b.r="\r",b.t="\t",b.v="";switch(a){case"u":var c=this.steal(4);if(c!=Tcl.isHexSeq.exec(c))throw"Invalid unicode escape sequence: "+c;a=String.fromCharCode(parseInt(c,16));break;case"x":var c=this.steal(2);if(c!=Tcl.isHexSeq.exec(c))throw"Invalid unicode escape sequence: "+c;a=String.fromCharCode(parseInt(c,16));break;case"a":case"b":case"f":case"n":case"r":case"t":case"v":a=b[a];break;default:if("0123456789".indexOf(a)>=0){a+=this.steal(2);if(a!=Tcl.isOctalSeq.exec(a))throw"Invalid octal escape sequence: "+a;a=String.fromCharCode(parseInt(a,8))}}this.text[index]=a,this.feedchar()},this.steal=function(a){var b=this.text.substring(this.index+1),c=b.substr(0,a);return this.text=this.text.substring(0,this.index-1)+b.substring(a),c},this.feedcharstart=function(){this.feedchar(),this.start=this.index},this.setPos=function(a){var b=a-this.index;this.index=a,this.len-=b,this.cur=this.text.charAt(this.index)},this.feedchar=function(){this.index++,this.len--;if(this.len<0)throw"End of file reached";this.cur=this.text.charAt(this.index)}}typeof window.console=="undefined"&&(window.console={_buf:[],_max:1e3,render:function(a,b){var c="";b=b||"\n";for(var d=0;d<this._buf.length;d++)c+=this._buf[d]+b;var e=document.getElementById(a),f=e.tagName,g;switch(f.toLowerCase()){case"textarea":case"input":g="value";break;case"div":case"p":default:g="innerHTML"}e[g]=c},log:function(){var a=arguments;for(var b=0;b<a.length;b++)this._buf.push(a[b].toString());this._buf.length>this._max&&this._buf.shift()},debug:function(){var a=arguments;this.log(a)},info:function(){var a=arguments;this.log(a)},warn:function(){var a=arguments;this.log(a)},error:function(){var a=arguments;this.log(a)},assert:function(){var a=arguments.shift(),b=arguments},clear:function(){this._buf=[]},dir:function(a){this.log(typeof a);for(var b in a)this.log(b+": "+a[b])},dirxml:function(a){},trace:function(){},group:function(){var a=arguments},groupCollapsed:function(){var a=arguments},groupEnd:function(){},time:function(a){},timeEnd:function(a){},profile:function(a){},profileEnd:function(){},count:function(a){},exception:function(){var a=arguments.shift(),b=arguments},table:function(a,b){}}),function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length<2){do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0)}else f=arguments[1];while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})}();var Zepto=function(){function a(a){return{}.toString.call(a)=="[object Function]"}function b(a){return a instanceof Object}function c(a){return a instanceof Array}function d(a){return typeof a.length=="number"}function e(a){return a.filter(function(a){return a!==t&&a!==null})}function f(a){return a.length>0?[].concat.apply([],a):a}function g(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function h(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function i(a){return a.filter(function(a,b,c){return c.indexOf(a)==b})}function j(a){return a in B?B[a]:B[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function k(a,b){return typeof b=="number"&&!D[h(a)]?b+"px":b}function l(a){var b,c;return A[a]||(b=z.createElement(a),z.body.appendChild(b),c=C(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),A[a]=c),A[a]}function m(a,b){b===t&&E.test(a)&&RegExp.$1,b in J||(b="*");var c=J[b];return c.innerHTML=""+a,y.call(c.childNodes)}function n(a,b){return a=a||x,a.__proto__=n.prototype,a.selector=b||"",a}function o(b,d){if(!b)return n();if(d!==t)return o(d).find(b);if(a(b))return o(z).ready(b);if(b instanceof n)return b;var f;return c(b)?f=e(b):F.indexOf(b.nodeType)<0&&b!==window?E.test(b)?(f=m(b.trim(),RegExp.$1),b=null):b.nodeType&&b.nodeType==3?f=[b]:f=v(z,b):(f=[b],b=null),n(f,b)}function p(a,b){return b===t?o(a):o(a).filter(b)}function q(b,c,d,e){return a(c)?c.call(b,d,e):c}function r(a,b,c){var d=a%2?b:b.parentNode;d.insertBefore(c,a?a==1?d.firstChild:a==2?b:null:b.nextSibling)}function s(a,b){b(a);for(var c in a.childNodes)s(a.childNodes[c],b)}var t,u,v,w,x=[],y=x.slice,z=window.document,A={},B={},C=z.defaultView.getComputedStyle,D={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},E=/^\s*<(\w+)[^>]*>/,F=[1,9,11],G=["after","prepend","before","append"],H=z.createElement("table"),I=z.createElement("tr"),J={tr:z.createElement("tbody"),tbody:H,thead:H,tfoot:H,td:I,th:I,"*":z.createElement("div")},K=/complete|loaded|interactive/,L=/^\.([\w-]+)$/,M=/^#([\w-]+)$/,N=/^[\w-]+$/;return o.extend=function(a){return y.call(arguments,1).forEach(function(b){for(u in b)a[u]=b[u]}),a},o.qsa=v=function(a,b){var c;return a===z&&M.test(b)?(c=a.getElementById(RegExp.$1))?[c]:x:y.call(L.test(b)?a.getElementsByClassName(RegExp.$1):N.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},o.isFunction=a,o.isObject=b,o.isArray=c,o.map=function(a,b){var c,e=[],g,h;if(d(a))for(g=0;g<a.length;g++)c=b(a[g],g),c!=null&&e.push(c);else for(h in a)c=b(a[h],h),c!=null&&e.push(c);return f(e)},o.each=function(a,b){var c,e;if(d(a)){for(c=0;c<a.length;c++)if(b(c,a[c])===!1)return a}else for(e in a)if(b(e,a[e])===!1)return a;return a},o.fn={forEach:x.forEach,reduce:x.reduce,push:x.push,indexOf:x.indexOf,concat:x.concat,map:function(a){return o.map(this,function(b,c){return a.call(b,c,b)})},slice:function(){return o(y.apply(this,arguments))},ready:function(a){return K.test(z.readyState)?a(o):z.addEventListener("DOMContentLoaded",function(){a(o)},!1),this},get:function(a){return a===t?this:this[a]},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return this.forEach(function(b,c){a.call(b,c,b)}),this},filter:function(a){return o([].filter.call(this,function(b){return b.parentNode&&v(b.parentNode,a).indexOf(b)>=0}))},end:function(){return this.prevObject||o()},andSelf:function(){return this.add(this.prevObject||o())},add:function(a,b){return o(i(this.concat(o(a,b))))},is:function(a){return this.length>0&&o(this[0]).filter(a).length>0},not:function(b){var c=[];if(a(b)&&b.call!==t)this.each(function(a){b.call(this,a)||c.push(this)});else{var e=typeof b=="string"?this.filter(b):d(b)&&a(b.item)?y.call(b):o(b);this.forEach(function(a){e.indexOf(a)<0&&c.push(a)})}return o(c)},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return o(this[0])},last:function(){return o(this[this.length-1])},find:function(a){var b;return this.length==1?b=v(this[0],a):b=this.map(function(){return v(this,a)}),o(b)},closest:function(a,b){var c=this[0],d=v(b||z,a);d.length||(c=null);while(c&&d.indexOf(c)<0)c=c!==b&&c!==z&&c.parentNode;return o(c)},parents:function(a){var b=[],c=this;while(c.length>0)c=o.map(c,function(a){if((a=a.parentNode)&&a!==z&&b.indexOf(a)<0)return b.push(a),a});return p(b,a)},parent:function(a){return p(i(this.pluck("parentNode")),a)},children:function(a){return p(this.map(function(){return y.call(this.children)}),a)},siblings:function(a){return p(this.map(function(a,b){return y.call(b.parentNode.children).filter(function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return this.map(function(){return this[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),C(this,"").getPropertyValue("display")=="none"&&(this.style.display=l(this.nodeName))})},replaceWith:function(a){return this.each(function(){o(this).before(a).remove()})},wrap:function(a){return this.each(function(){o(this).wrapAll(o(a)[0].cloneNode(!1))})},wrapAll:function(a){return this[0]&&(o(this[0]).before(a=o(a)),a.append(this)),this},unwrap:function(){return this.parent().each(function(){o(this).replaceWith(o(this).children())}),this},hide:function(){return this.css("display","none")},toggle:function(a){return(a===t?this.css("display")=="none":a)?this.show():this.hide()},prev:function(){return o(this.pluck("previousElementSibling"))},next:function(){return o(this.pluck("nextElementSibling"))},html:function(a){return a===t?this.length>0?this[0].innerHTML:null:this.each(function(b){var c=this.innerHTML;o(this).empty().append(q(this,a,b,c))})},text:function(a){return a===t?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=a})},attr:function(a,c){var d;return typeof a=="string"&&c===t?this.length==0?t:a=="value"&&this[0].nodeName=="INPUT"?this.val():!(d=this[0].getAttribute(a))&&a in this[0]?this[0][a]:d:this.each(function(d){if(b(a))for(u in a)this.setAttribute(u,a[u]);else this.setAttribute(a,q(this,c,d,this.getAttribute(a)))})},removeAttr:function(a){return this.each(function(){this.removeAttribute(a)})},data:function(a,b){return this.attr("data-"+a,b)},val:function(a){return a===t?this.length>0?this[0].value:null:this.each(function(b){this.value=q(this,a,b,this.value)})},offset:function(){if(this.length==0)return null;var a=this[0].getBoundingClientRect();return{left:a.left+z.body.scrollLeft,top:a.top+z.body.scrollTop,width:a.width,height:a.height}},css:function(a,b){if(b===t&&typeof a=="string")return this.length==0?t:this[0].style[g(a)]||C(this[0],"").getPropertyValue(a);var c="";for(u in a)c+=h(u)+":"+k(u,a[u])+";";return typeof a=="string"&&(c=h(a)+":"+k(a,b)),this.each(function(){this.style.cssText+=";"+c})},index:function(a){return a?this.indexOf(o(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return this.length<1?!1:j(a).test(this[0].className)},addClass:function(a){return this.each(function(b){w=[];var c=this.className,d=q(this,a,b,c);d.split(/\s+/g).forEach(function(a){o(this).hasClass(a)||w.push(a)},this),w.length&&(this.className+=(c?" ":"")+w.join(" "))})},removeClass:function(a){return this.each(function(b){if(a===t)return this.className="";w=this.className,q(this,a,b,w).split(/\s+/g).forEach(function(a){w=w.replace(j(a)," ")}),this.className=w.trim()})},toggleClass:function(a,b){return this.each(function(c){var d=q(this,a,c,this.className);(b===t?!o(this).hasClass(d):b)?o(this).addClass(d):o(this).removeClass(d)})}},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(a){var b=o.fn[a];o.fn[a]=function(){var a=b.apply(this,arguments);return a.prevObject=this,a}}),["width","height"].forEach(function(a){o.fn[a]=function(b){var c,d=a.replace(/./,function(a){return a[0].toUpperCase()});return b===t?this[0]==window?window["inner"+d]:this[0]==z?z.documentElement["offset"+d]:(c=this.offset())&&c[a]:this.each(function(c){var d=o(this);d.css(a,q(this,b,c,d[a]()))})}}),G.forEach(function(a,c){o.fn[a]=function(a){var d=b(a)?a:m(a);"length"in d||(d=[d]);if(d.length<1)return this;var e=this.length,f=e>1,g=c<2;return this.each(function(a,b){for(var h=0;h<d.length;h++){var i=d[g?d.length-h-1:h];s(i,function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&window.eval.call(window,a.innerHTML)}),f&&a<e-1&&(i=i.cloneNode(!0)),r(c,b,i)}})};var d=c%2?a+"To":"insert"+(c?"Before":"After");o.fn[d]=function(b){return o(b)[a](this),this}}),n.prototype=o.fn,o}();"$"in window||(window.$=Zepto),function(a){function b(a){return a._zid||(a._zid=m++)}function c(a,c,f,g){c=d(c);if(c.ns)var h=e(c.ns);return(l[b(a)]||[]).filter(function(a){return a&&(!c.e||a.e==c.e)&&(!c.ns||h.test(a.ns))&&(!f||a.fn==f)&&(!g||a.sel==g)})}function d(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function e(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function f(b,c,d){a.isObject(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function g(c,e,g,h,i){var j=b(c),k=l[j]||(l[j]=[]);f(e,g,function(b,e){var f=i&&i(e,b),g=f||e,j=function(a){var b=g.apply(c,[a].concat(a.data));return b===!1&&a.preventDefault(),b},l=a.extend(d(b),{fn:e,proxy:j,sel:h,del:f,i:k.length});k.push(l),c.addEventListener(l.e,j,!1)})}function h(a,d,e,g){var h=b(a);f(d||"",e,function(b,d){c(a,b,d,g).forEach(function(b){delete l[h][b.i],a.removeEventListener(b.e,b.proxy,!1)})})}function i(b){var c=a.extend({originalEvent:b},b);return a.each(q,function(a,d){c[a]=function(){return this[d]=o,b[a].apply(b,arguments)},c[d]=p}),c}function j(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var k=a.qsa,l={},m=1,n={};n.click=n.mousedown=n.mouseup=n.mousemove="MouseEvents",a.event={add:g,remove:h},a.fn.bind=function(a,b){return this.each(function(){g(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){h(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){g(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return h(d,b,a),c}})})};var o=function(){return!0},p=function(){return!1},q={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){return this.each(function(e,f){g(f,c,d,b,function(c){return function(d){var e,g=a(d.target).closest(b,f).get(0);if(g)return e=a.extend(i(d),{currentTarget:g,liveFired:f}),c.apply(g,[e].concat([].slice.call(arguments,1)))}})})},a.fn.undelegate=function(a,b,c){return this.each(function(){h(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.trigger=function(b,c){return typeof b=="string"&&(b=a.Event(b)),j(b),b.data=c,this.each(function(){this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,d){var e,f;return this.each(function(
g,h){e=i(typeof b=="string"?a.Event(b):b),e.data=d,e.target=h,a.each(c(h,b.type||b),function(a,b){f=b.proxy(e);if(e.isImmediatePropagationStopped())return!1})}),f},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){if(a)this.bind(b,a);else if(this.length)try{this.get(0)[b]()}catch(c){}return this}}),a.Event=function(a,b){var c=document.createEvent(n[a]||"Events"),d=!0;if(b)for(var e in b)e=="bubbles"?d=!!b[e]:c[e]=b[e];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c}}(Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/(BlackBerry).*Version\/([\d.]+)/);d&&(c.version=d[1]),c.webkit=!!d,e&&(b.android=!0,b.version=e[2]),g&&(b.ios=!0,b.version=g[2].replace(/_/g,"."),b.iphone=!0),f&&(b.ios=!0,b.version=f[2].replace(/_/g,"."),b.ipad=!0),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),j&&(b.blackberry=!0,b.version=j[2])}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a,b){function c(a){return a.toLowerCase()}function d(a){return f?f+a:c(a)}var e="",f,g,h,i={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},j=window.document,k=j.createElement("div"),l=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;a.each(i,function(a,d){if(k.style[a+"TransitionProperty"]!==b)return e="-"+c(a)+"-",f=d,!1}),a.fx={off:!1,cssPrefix:e,transitionEnd:d("TransitionEnd"),animationEnd:d("AnimationEnd")},a.fn.anim=function(c,d,f,g){var h,i={},j,k=this,m,n=a.fx.transitionEnd;d===b&&(d=.5),a.fx.off&&(d=0);if(typeof c=="string")i[e+"animation-name"]=c,i[e+"animation-duration"]=d+"s",n=a.fx.animationEnd;else{for(j in c)l.test(j)?(h||(h=[]),h.push(j+"("+c[j]+")")):i[j]=c[j];h&&(i[e+"transform"]=h.join(" ")),a.fx.off||(i[e+"transition"]="all "+d+"s "+(f||""))}return m=function(){var b={};b[e+"transition"]=b[e+"animation-name"]="none",a(this).css(b),g&&g.call(this)},d>0&&this.one(n,m),setTimeout(function(){k.css(i),d<=0&&setTimeout(function(){k.each(function(){m.call(this)})},0)},0),this},k=null}(Zepto),function(a,b){function c(a){return typeof a=="number"?a:l[a]||l._default}function d(d,e,f,g,h){typeof e=="function"&&!h&&(h=e,e=b);var i={opacity:f};return g&&(a.fx.transforms3d?i.scale3d=g+",1":i.scale=g,d.css(a.fx.cssPrefix+"transform-origin","0 0")),d.anim(i,c(e)/1e3,null,h)}function e(b,c,e,f){return d(b,c,0,e,function(){j.call(a(this)),f&&f.call(this)})}function f(){var a,b=g.createElement("div"),c=g.createElement("div"),d="@media (-webkit-transform-3d){#zeptotest{left:9px;position:absolute}}",e=["&shy;","<style>",d,"</style>"].join("");return b.innerHTML+=e,c.id="zeptotest",b.appendChild(c),h.appendChild(b),a=c.offsetLeft===9,b.parentNode.removeChild(b),a}var g=window.document,h=g.documentElement,i=a.fn.show,j=a.fn.hide,k=a.fn.toggle,l={_default:400,fast:200,slow:600};a.fn.show=function(a,c){return i.call(this),a===b?a=0:this.css("opacity",0),d(this,a,1,"1,1",c)},a.fn.hide=function(a,c){return a===b?j.call(this):e(this,a,"0,0",c)},a.fn.toggle=function(a,c){return a===b||typeof a=="boolean"?k.call(this,a):this[this.css("display")=="none"?"show":"hide"](a,c)},a.fn.fadeTo=function(a,b,c){return d(this,a,b,null,c)},a.fn.fadeIn=function(a,b){var c=this.css("opacity");return c>0?this.css("opacity",0):c=1,i.call(this).fadeTo(a,c,b)},a.fn.fadeOut=function(a,b){return e(this,a,null,b)},a.fn.fadeToggle=function(a,b){var c=this.css("opacity")==0||this.css("display")=="none";return this[c?"fadeIn":"fadeOut"](a,b)},a.extend(a.fx,{speeds:l,transforms3d:function(c){var d=!1;return a.each(c,function(a,c){if(h.style[c]!==b)return d=a!=1||f(),!1}),d}("perspectiveProperty WebkitPerspective MozPerspective OPerspective msPerspective".split(" "))})}(Zepto),function(a){function b(){}function c(b,d,f,g){var h=a.isArray(d);a.each(d,function(d,i){g&&(d=f?g:g+"["+(h?"":d)+"]"),!g&&h?b.add(i.name,i.value):(f?a.isArray(i):e(i))?c(b,i,f,d):b.add(d,i)})}var d=0,e=a.isObject,f;a.ajaxJSONP=function(c){var e="jsonp"+ ++d,f=document.createElement("script"),g=c.context,h=function(){a(f).remove(),e in window&&(window[e]=b)},i={abort:h},j;return window[e]=function(b){clearTimeout(j),a(f).remove(),delete window[e],c.success.call(g,b)},f.src=c.url.replace(/=\?/,"="+e),a("head").append(f),c.timeout>0&&(j=setTimeout(function(){i.abort(),c.error.call(g,i,"timeout")},c.timeout)),i},a.ajaxSettings={type:"GET",beforeSend:b,success:b,error:b,complete:b,context:null,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},timeout:0},a.ajax=function(c){c=c||{};var d=a.extend({},c);for(f in a.ajaxSettings)d[f]||(d[f]=a.ajaxSettings[f]);if(/=\?/.test(d.url))return a.ajaxJSONP(d);d.url||(d.url=window.location.toString()),d.data&&!d.contentType&&(d.contentType="application/x-www-form-urlencoded"),e(d.data)&&(d.data=a.param(d.data));if(d.type.match(/get/i)&&d.data){var g=d.data;d.url.match(/\?.*=/)?g="&"+g:g[0]!="?"&&(g="?"+g),d.url+=g}var h=d.accepts[d.dataType],i=a.ajaxSettings.xhr(),j,k=d.context;d.headers=a.extend({"X-Requested-With":"XMLHttpRequest"},d.headers||{}),h&&(d.headers.Accept=h),i.onreadystatechange=function(){if(i.readyState==4){clearTimeout(j);var a,b=!1;if(i.status>=200&&i.status<300||i.status==0){if(h=="application/json"&&!/^\s*$/.test(i.responseText))try{a=JSON.parse(i.responseText)}catch(c){b=c}else a=i.responseText;b?d.error.call(k,i,"parsererror",b):d.success.call(k,a,"success",i)}else b=!0,d.error.call(k,i,"error");d.complete.call(k,i,b?"error":"success")}};var l=d.async!=undefined?d.async:!0;i.open(d.type,d.url,l),d.contentType&&(d.headers["Content-Type"]=d.contentType);for(name in d.headers)i.setRequestHeader(name,d.headers[name]);return d.beforeSend.call(k,i,d)===!1?(i.abort(),!1):(d.timeout>0&&(j=setTimeout(function(){i.onreadystatechange=b,i.abort(),d.error.call(k,i,"timeout")},d.timeout)),i.send(d.data),i)},a.get=function(b,c){return a.ajax({url:b,success:c})},a.post=function(b,c,d,e){return a.isFunction(c)&&(e=e||d,d=c,c=null),a.ajax({type:"POST",url:b,data:c,success:d,dataType:e})},a.getJSON=function(b,c){return a.ajax({url:b,success:c,dataType:"json"})},a.fn.load=function(b,c){if(!this.length)return this;var d=this,e=b.split(/\s/),f;return e.length>1&&(b=e[0],f=e[1]),a.get(b,function(b){d.html(f?a(document.createElement("div")).html(b).find(f).html():b),c&&c.call(d)}),this};var g=encodeURIComponent;a.param=function(a,b){var d=[];return d.add=function(a,b){this.push(g(a)+"="+g(b))},c(d,a,b),d.join("&").replace("%20","+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this),(c.attr("type")!=="radio"||c.is(":checked"))&&(c.attr("type")!=="checkbox"||!!c.is(":checked"))&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a){function b(a){return"tagName"in a?a:a.parentNode}function c(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e<f?c-d>0?"Up":"Down":a-b>0?"Left":"Right"}function d(){e.last&&Date.now()-e.last>=g&&(a(e.target).trigger("longTap"),e={})}var e={},f,g=750;a(document).ready(function(){a(document.body).bind("touchstart",function(a){var c=Date.now(),h=c-(e.last||c);e.target=b(a.touches[0].target),f&&clearTimeout(f),e.x1=a.touches[0].pageX,e.y1=a.touches[0].pageY,h>0&&h<=250&&(e.isDoubleTap=!0),e.last=c,setTimeout(d,g)}).bind("touchmove",function(a){e.x2=a.touches[0].pageX,e.y2=a.touches[0].pageY}).bind("touchend",function(b){e.isDoubleTap?(a(e.target).trigger("doubleTap"),e={}):e.x2>0||e.y2>0?((Math.abs(e.x1-e.x2)>30||Math.abs(e.y1-e.y2)>30)&&a(e.target).trigger("swipe")&&a(e.target).trigger("swipe"+c(e.x1,e.x2,e.y1,e.y2)),e.x1=e.x2=e.y1=e.y2=e.last=0):"last"in e&&(f=setTimeout(function(){f=null,a(e.target).trigger("tap"),e={}},250))}).bind("touchcancel",function(){e={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto),function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function g(){!a&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g}}(),_step=0;var Tcl=new Object;Tcl.isReal=new RegExp("^[+\\-]?[0-9]+\\.[0-9]*([eE][+\\-]?[0-9]+)?$"),Tcl.isDecimal=new RegExp("^[+\\-]?[1-9][0-9]*$"),Tcl.isHex=new RegExp("^0x[0-9a-fA-F]+$"),Tcl.isOctal=new RegExp("^[+\\-]?0[0-7]*$"),Tcl.isHexSeq=new RegExp("[0-9a-fA-F]*"),Tcl.isOctalSeq=new RegExp("[0-7]*"),Tcl.isList=new RegExp("[\\{\\} ]"),Tcl.isNested=new RegExp("^\\{.*\\}$"),Tcl.getVar=new RegExp("^[a-zA-Z0-9_]+","g"),Tcl.Source=function(a,b){var c=null;if(window.ActiveXObject)c=new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)c=new XMLHttpRequest;else{alert("Your browser does not support XMLHTTP requests. Sorry that we cannot deliver this page.");return}return c.open("GET",b,!1),c.send(null),a.eval(c.responseText)},Tcl.Proc=function(a,b){var c=this.privdata;a.incrLevel();var d=c[0].toList(),e=c[1];b.shift();for(var f=0;f<d.length;f++){var g=d[f].toString();if(f>=b.length&&g=="args"){a.setVar("args",Tcl.empty);break}if(Tcl.isList.test(g)){g=a.parseString(g).toList();if(g[0]=="args")throw"'args' defaults to the empty string";f<b.length?a.setVar(g[0],a.objectify(b[f])):a.setVar(g.shift(),a.parseString(g.join(" ")))}else if(g=="args"){a.setVar("args",new TclObject(b.slice(f,b.length)));break}a.setVar(g,a.objectify(b[f]))}if(g=="args"&&f+1<d.length)throw"'args' should be the last argument";try{var h=a.eval(e);return a.code=a.OK,a.decrLevel(),h}catch(i){throw a.decrLevel(),"Tcl.Proc exception "+i}},Tcl.EnsembleCommand=function(a,b){var c=b[1].toString(),d=b.shift().toString()+c;b[0]=d;var e=this.ensemble;if(e==null||e[c]==null)throw"Not an ensemble command: "+d;return e[c].call(a,b)},Tcl.InfoSubcommands=function(a,b){var c=new Array;for(var d in this.ensemble)c.push(d);return a.objectify(c)};var HxClass=Class.extend({init:function(a){a=a||{}}});window.HxGUID=function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return{next:function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}}();var HxBus=function(){var a={"default":{subscriptions:{}}};return{publish:function(b,c,d,e){e=e?e:"default";if(!a.hasOwnProperty(e)){console.warn('system bus: publish: "'+e+'" is not a registered channel');return}if(!a[e].subscriptions.hasOwnProperty(b)){console.warn('system bus: publish: "'+b+'" is not a registered message');return}c=c?c:[];for(var f=0;f<a[e].subscriptions[b].length;f++)d?a[e].subscriptions[b][f].call(d,c):a[e].subscriptions[b][f](c)},subscribe:function(b,c,d){if(typeof c!="function")throw new Error("system bus: subscribe: fn must be a function");d=d?d:"default",a.hasOwnProperty(d)||(a[d]={subscriptions:{}}),a[d].subscriptions[b]||(a[d].subscriptions[b]=new Array),a[d].subscriptions[b].push(c)},unsubscribe:function(b,c,d){if(typeof c!="function")throw new Error("system bus: unsubscribe: fn must be a function");d=d?d:"default";for(var e=0;e<a[d].subscriptions[b].length;e++)if(a[d].subscriptions[b][e]===c){a[d].subscriptions[b].splice(e,1);return}}}}(),HxStream=HxClass.extend({init:function(a){a=a||{},this.name=a.name||HxGUID.next(),this.bus=a.bus||HxBus,this.buffer=a.buffer||"",this.autoFlush="autoFlush"in a?a.autoFlush:!0;var b=this;this.bus.subscribe("rollcall",function(){console.log('stream "'+b.name+'" responding')})},read:function(){var a=this.buffer;return this.autoFlush&&this.flush(),a},write:function(a){return this.buffer=a,this.bus.publish(this.name+":ondata",this.buffer.length),this},append:function(a){return this.buffer+=a,this.bus.publish(this.name+":ondata",this.buffer.length),this},flush:function(){this.buffer=""}}),HxFile=HxStream.extend({init:function(a){this._super(a),this.autoFlush=!1}}),HxDevice=HxStream.extend({init:function(a){this._super(a)}}),HxRemoteFile=HxFile.extend({init:function(a){this._super(a),this.dev=system.fs.tree.dev.tree.net,this.read(),this.buffer==""&&this.dev.send({cmd:"file",subcmd:"create",path:this.name},function(a){try{var b=JSON.parse(b);console.log("HxRemoteFile.init: remote file creation response:"),console.dir(b)}catch(c){}})},read:function(){path=this.name;var a=this;return fileAction={cmd:"file",subcmd:"read",path:path},this.dev.send(fileAction,function(b){var c=JSON.parse(b);a.buffer=c.data}),this.buffer||!1},write:function(a){this.buffer=a;var b=this.name;return fileAction={cmd:"file",subcmd:"write",path:b,buffer:a},this.dev.send(fileAction,function(a){var b=JSON.parse(a);console.dir(b)}),this},append:function(a){this.buffer+=a;var b=this.name;return fileAction={cmd:"file",subcmd:"append",path:b,buffer:a},this.dev.send(fileAction,function(a){var b=JSON.parse(a);console.dir(b)}),this}}),HxJSFS=HxStream.extend({init:function(a){this.tree=a.tree||{},this._super(a)},traverse:function(a,b,c){for(i in a)typeof a[i]!="function"&&b.apply(this,[i,a[i],c]),a[i]instanceof HxJSFS&&this.traverse(a[i].tree,b,i)},getNodeRecursive:function(a){var b=[];return this.traverse(this.tree,function(c,d,e){c===a&&b.push({parent:e,value:d})}),b},getPath:function(a){var b="/"+a,c=this.getNodeRecursive(a);if(c.length>0){var d=c[0].parent;d&&(b=this.getPath(d)+b)}return b},find:function(a){var b=[],c=this.getNodeRecursive(a);for(var d in c){var e=c[d].parent,f=this.getPath(e)+"/"+a;b.push({path:f,file:c[d].value})}return b},basename:function(a){return a.match(/\//)?a.split("/").pop():a},listFiles:function(){var a=[];for(var b in this.tree){var c=this.tree[b];a.push({path:b,file:c})}return a.sort(function(a,b){var c=a.path.toLowerCase(),d=b.path.toLowerCase();return c<d?-1:c>d?1:0})},readFile:function(a){var b=this.basename(a),c=this.find(b);for(var d=0;d<c.length;d++)if(c[d].path==a)return c[d].file.read();return console.warn('file "'+a+'" not found'),!1},writeFile:function(path,buf,append){var nodeName=this.basename(path),candidates=this.find(nodeName);for(var i=0;i<candidates.length;i++)if(candidates[i].path==path){if(append)candidates[i].file.append(buf);else{candidates[i].file.write(buf);try{if(path.match(/^\/bin\//)){var warning="saving to /bin not currently supported, but trying anyway...";system.wash.fd[1].write(warning);var binpath="system"+path.replace(/\//g,"."),binobj=eval(binpath);binobj.exec=eval(buf)}}catch(e){system.wash.fd[1].write("sorry, it didn't work")}}return!0}return!1},getFolder:function(path){if(path=="/")return system.fs;path=path.replace(/\/$/,"");var folderObj,fspath="system.fs",newpath="",pathParts=path.split("/");if(pathParts.length>1){pathParts.shift();for(var i=0;i<pathParts.length;i++)pathParts[i].match(/-/)?newpath+='.tree["'+pathParts[i]+'"]':newpath+=".tree."+pathParts[i]}fspath+=newpath;try{folderObj=eval(fspath)}catch(e){return console.warn("HxJSFS.getFolder: js exception: "+e),!1}return folderObj?folderObj:!1},mount:function(a,b){var c=this.basename(b.name),d=this.getFolder(a);d.tree[c]=b},addChildFolder:function(a){return this.tree[a]=new HxJSFS({}),this.tree[a]instanceof HxJSFS?this.tree[a]:!1},removeChildFolder:function(a){if(this.tree[a]&&this.tree[a]instanceof HxJSFS)return delete this.tree[a],this.tree[a]?!1:!0},addFile:function(a,b){return b=b||"",this.tree[a]=new HxFile({name:a,buffer:b}),this.tree[a]instanceof HxFile?this.tree[a]:!1},removeFile:function(a){if(this.tree[a]&&this.tree[a]instanceof HxFile)return delete this.tree[a],this.tree[a]?!1:!0}}),HxPROCFS=HxJSFS.extend({init:function(a){this.tree=a.tree||{},this._super(a)},addChildFolder:function(a){return this.tree[a]=new HxPROCFS({}),this.tree[a]instanceof HxPROCFS?this.tree[a]:!1}}),HxDOMFS=HxJSFS.extend({init:function(a){this.tree=a.tree||{},this._super(a)},addChildFolder:function(a){return this.tree[a]=new HxDOMFS({}),this.tree[a]instanceof HxDOMFS},addFile:function(a){return $("#fileroot").append('<div class="domfile"></div>'),this.tree[a]=new HxFile({name:a}),this.tree[a]instanceof HxFile}}),HxNETFS=HxJSFS.extend({init:function(a){this.tree=a.tree||{},this._super(a)},addChildFolder:function(a){return this.tree[a]=new HxNETFS({}),this.tree[a]instanceof HxNETFS},addFile:function(a){return this.tree[a]=new HxRemoteFile({name:a}),this.tree[a]instanceof HxRemoteFile}}),HxProcess=HxClass.extend({init:function(a){a=a||{},this.name=a.name||HxGUID.next(),this._super(a),this.fd=[new HxStream({}),new HxStream({}),new HxStream({})],system.lib.registerProcess(this)}}),HxWash=HxProcess.extend({init:function(a){a=a||{},this._super(a);var b=this,c=this.fd[0].name,d=this.fd[1].name,e=this.fd[2].name;this.fd[0].bus.subscribe(c+":ondata",this.onInput),this.fd[1].bus.subscribe(d+":ondata",this.onOutput),this.fd[2].bus.subscribe(e+":ondata",this.onError)},exec:function(command){var args=command.match(" ")?command.split(" "):command;try{var cmdName=args instanceof Array?args.shift():command;basename=system.fs.basename(cmdName),cmdObj=null;if(system.bin[basename])cmdObj=eval(system.bin[basename]);else{var notFound="command not found";this.fd[1].write(notFound),console.warn(notFound)}cmdObj&&cmdObj.exec.call(this,args)}catch(e){console.warn("WASH Exception:"),console.dir(e)}},onInput:function(a){var b=system.proc.wash.fd[0].read();system.proc.wash.exec(b)},onOutput:function(a){var b=system.proc.wash.fd[1].read();console.log(b)},onError:function(a){var b=system.proc.wash.fd[2].read();console.warn(b)}}),HxTcl=HxProcess.extend({init:function(a){a=a||{},this._super(a);var b=this,c=this.fd[0].name,d=this.fd[1].name,e=this.fd[2].name;this.fd[0].bus.subscribe(c+":ondata",this.onInput),this.fd[1].bus.subscribe(d+":ondata",this.onOutput),this.fd[2].bus.subscribe(e+":ondata",this.onError),this.interpreter=new TclInterp},exec:function(a){var b;try{b=this.interpreter.eval(a)}catch(c){console.warn("TCL Exception:"),console.dir(c)}return b},onInput:function(a){var b=system.proc.tcl.fd[0].read();system.proc.tcl.exec(b)},onOutput:function(a){var b=system.proc.tcl.fd[1].read();console.log(b)},onError:function(a){var b=system.proc.tcl.fd[2].read();console.warn(b)}}),HxPanel=HxJSFS.extend({init:function(a){this._super(a),this.toggleState=a&&a.toggled?a.toggled:!0,this.name=a&&a.name?a.name:HxGUID.next(),this.parentEl=a&&a.parentEl?a.parentEl:"winroot",this.bus=a&&a.bus?a.bus:HxBus,this.mountPoint=a&&a.mount?a.mount:null,this.name.match(/\//)&&(this.name=system.fs.basename(this.name));var b='<div id="'+this.name+'" class="ui-panel"></div>';$("#"+this.parentEl).append(b),this.hxpanel=$("#"+this.name),a&&a.className&&this.hxpanel.addClass(a.className),a&&a.css&&this.hxpanel.css(a.css),this.mountPoint&&system.fs.mount(this.mountPoint,this)},get:function(){return this.hxpanel},getName:function(){return this.name},moveTo:function(a,b){this.hxpanel.css({top:b,left:a})},resizeTo:function(a,b){this.hxpanel.css({right:a,bottom:b})},toggle:function(){return toggleState=toggleState?!1:!0,this.hxpanel.fadeToggle(),toggleState}}),HxWindow=HxPanel.extend({init:function(a){a=a||{},a.defaultStyle&&(a.css=a.css||{},a.css.position="absolute",a.css.backgroundColor="#ccc",a.css.border="2px outset #eee"),this._super(a),this.title=a.title||"Window "+this.name,this.inputHandler=a.inputHandler||function(){},this.outputHandler=a.outputHandler||function(){},this.errorHandler=a.errorHandler||function(){};var b="<div id='"+this.name+"-titlebar' class='titlebar'>"+this.title+"</div><div id='"+this.name+"-content'></div>";this.get().append(b)},getTitlebar:function(){return $("#"+this.name+"-titlebar")},getContent:function(){return $("#"+this.name+"-content")}}),HxCommandWindow=HxWindow.extend({init:function(a){a=a||{},this._super(a),this.history=[],this.historyPtr=this.history.length;var b="<div id='"+this.name+"-h-output'><textarea id='"+this.name+"-output' class='rounded'>Welcome to WASH, the Web Application SHell\n</textarea></div>",c="<span id='"+this.name+"-prompt'>"+system.env.cwd+" $ </span>"+"<div id='"+this.name+"-h-input'><input id='"+this.name+"-input' type='text' /></div>"+"<button id='"+this.name+"-btn'>ENTER</button>",d=b+c;this.getContent().append(d);var e=this,f=$("#"+this.name+"-h-output"),g=$("#"+this.name+"-output");f.css({display:"block",position:"absolute",top:"30px",left:"2px",right:"2px",bottom:"32px"}),g.css({width:"99%",height:"99%",color:"#888",fontFamily:"Courier",fontSize:"15px"});var h=$("#"+this.name+"-prompt");h.css({display:"inline-block",position:"absolute",bottom:"5px",left:"0px",width:"20%",textAlign:"right",overflow:"hidden",backgroundColor:"#fff",height:"20px",border:"0px solid #000"}),h.click(function(){$("#"+e.name+"-input").focus()});var i=$("#"+this.name+"-btn");i.css({position:"absolute",bottom:"4px",right:"10px"}).addClass("ui-btn disabled"),i.click(function(){e.exec.call(e)});var j=$("#"+this.name+"-h-input"),k=$("#"+this.name+"-input");j.css({position:"absolute",height:20,bottom:5,left:"20%",right:80,margin:0,padding:0}),k.css({width:"99%",height:18,outline:"none",border:"0px solid #000",margin:"0px",paddingLeft:"0.25em"}),k.keyup(function(a){this.value.length>0?$("#"+e.name+"-btn").removeClass("disabled"):$("#"+e.name+"-btn").addClass("disabled");switch(a.keyCode){case 13:$("#"+e.name+"-btn").trigger("click");break;case 38:e.historyPtr>0&&e.historyPtr--,$("#"+e.name+"-input").val(e.history[e.historyPtr]);break;case 40:var b="";e.historyPtr<e.history.length?(e.historyPtr++,b=e.history[e.historyPtr]):b="",$("#"+e.name+"-input").val(b);break;default:}}),k[0].focus()},exec:function(a){var b=$("#"+this.name+"-input"),c=b.val();b.val(""),this.history.push(c),system.proc.wash.fd[1].write("\n"+system.env.cwd+"$ "+c),system.proc.wash.fd[0].write(c),b[0].focus(),this.historyPtr=this.history.length;var d=system.env.cwd+" $";$("#"+this.name+"-prompt").html(d)},cls:function(){$("#"+this.name+"-output").val("")}}),HxEditWindow=HxWindow.extend({init:function(a){a=a||{},this._super(a),this.history=[],this.historyPtr=this.history.length;var b="<div id='"+this.name+"-h-editor'><textarea id='"+this.name+"-editor' class='rounded'></textarea></div>"+"<span id='"+this.name+"-status' class='statusbar rounded'></span>",c="<span style='position: absolute; top: 37px; left: 215px; font-size: 14px; font-family: verdana;'>Filename:</span><div id='"+this.name+"-h-filename'><input id='"+this.name+"-filename' type='text' /></div>"+"<button id='"+this.name+"-btnnew'  class='ui-btn' style='position: absolute; top: 35px; left: 10px;'>NEW</button>"+"<button id='"+this.name+"-btnload' class='ui-btn disabled' style='position: absolute; top: 35px; left: 80px;'>LOAD</button>"+"<button id='"+this.name+"-btnsave' class='ui-btn disabled' style='position: absolute; top: 35px; left: 150px;'>SAVE</button>",d=b+c;this.getContent().append(d);var e=this,f=$("#"+this.name+"-h-editor").css({position:"absolute",top:65,left:2,right:0,bottom:32}),g=$("#"+this.name+"-editor").css({width:"99%",height:"99%"}),h=$("#"+this.name+"-btnnew");h.click(function(){$("#"+e.name+"-filename").val(""),$("#"+e.name+"-editor").val(""),$("#"+e.name+"-btnload").addClass("disabled"),$("#"+e.name+"-btnsave").addClass("disabled"),e.notify("File buffer cleared.")});var i=$("#"+this.name+"-btnload");i.click(function(){e.load()});var j=$("#"+this.name+"-btnsave");j.click(function(){e.save()});var k=$("#"+this.name+"-h-filename");k.css({position:"absolute",height:20,top:35,left:290,right:5});var l=$("#"+this.name+"-filename");l.css({width:"99%"}).addClass("rounded"),l.keyup(function(a){this.value.length>0?($("#"+e.name+"-btnload").removeClass("disabled"),$("#"+e.name+"-btnsave").removeClass("disabled")):($("#"+e.name+"-btnload").addClass("disabled"),$("#"+e.name+"-btnsave").addClass("disabled"));switch(a.keyCode){case 13:$("#"+e.name+"-btnsave").hasClass("disabled")||($("#"+e.name+"-btnload").trigger("click"),$("#"+e.name+"-editor").focus());break;case 38:e.historyPtr>0&&e.historyPtr--,$("#"+e.name+"-filename").val(e.history[e.historyPtr]);break;case 40:var b="";e.historyPtr<e.history.length?(e.historyPtr++,b=e.history[e.historyPtr]):b="",$("#"+e.name+"-filename").val(b);break;default:}})},load:function(){var a=$("#"+this.name+"-filename"),b=a.val();this.history.push(b);var c=system.fs.readFile(b);c?($("#"+this.name+"-editor").val(c),$("#"+this.name+"-btnsave").removeClass("disabled"),a[0].focus(),this.historyPtr=this.history.length,this.notify('File "'+b+'" loaded.')):this.notify('File "'+b+'" not found.')},save:function(){var a=$("#"+this.name+"-filename"),b=a.val(),c=$("#"+this.name+"-editor").val();system.fs.writeFile(b,c);var d=system.fs.readFile(b);c==d&&this.notify('File "'+b+'" saved.')},cls:function(){$("#"+this.name+"-editor").val("")},notify:function(a){var b=$("#"+this.name+"-status");b.html(a),setTimeout(function(){b.html("")},2e3)}}),HxDocWindow=HxWindow.extend({init:function(a){a=a||{},this._super(a);var b="<div id='"+this.name+"-h-iframe'><iframe id='"+this.name+"-iframe' class='rounded' src='scripts/docs/index.html'></iframe></div>";this.getContent().append(b);var c=this,d=$("#"+this.name+"-h-iframe").css({position:"absolute",top:35,left:15,right:0,bottom:15}),e=$("#"+this.name+"-iframe").css({width:"99%",height:"99%"})}});window.system=window.system||{},system.bin=system.bin||{},system.bin.cat={help:function(){return"Echo file contents to stdout\n\n  Usage: cat [filepath]"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=a instanceof Array?a.shift():a;e=e.match(/^\//)?e:system.env.cwd+"/"+e;var f=system.fs.readFile(e);f?c&&c.write(f):c&&c.write('file "'+e+'" not found')}catch(g){console.log("command exception:"),console.dir(g)}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.cd={help:function(){return"Change Directory\n\n  Usage: cd [path]\n\nNOTE: Supports  ~ (home folder), - (last folder), and .. (parent folder)"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=a instanceof Array?a.shift():a,f=!1;if(e=="-"){var g=system.env.pwd;system.env.pwd=system.env.cwd,system.env.cwd=g,f=!0}else if(e=="~")system.env.pwd=system.env.cwd,system.env.cwd=system.env.home,f=!0;else if(e.match(/\.\./)){system.debug&&console.warn("..: original path: "+e);var h=system.env.cwd;system.debug&&console.warn("..: cwd: "+h);while(e.match(/\.\./)){e=e.replace(/\.\./,"");var i=h.split("/");i.pop(),h=i.join("/")}e=e.replace(/\/\//g,"/"),system.debug&&(console.warn("..: result: "+h),console.warn("..: transformed path: "+e)),e=h?e=="/"?h:e.match(/^\//)?h+e:h+"/"+e:"/",e=e.replace(/\/$/,""),system.debug&&console.warn("..: final path: "+e)}f||(e.match(/^\//)||(e=system.env.cwd=="/"?"/"+e:system.env.cwd+"/"+e),system.fs.getFolder(e)&&(system.env.pwd=system.env.cwd||"/",system.env.cwd=e,f=!0));var j=f?system.env.cwd:'folder "'+e+'" not found';c&&c.write(j)}catch(k){console.log("command exception:"),console.dir(k)}return system.env.pwd}},window.system=window.system||{},system.bin=system.bin||{},system.bin.clear={help:function(){return"Clear command console's output window\n\n  Usage: clear\n\nNote: the clear command is currently broken.  After running this command, the global wash stdout stream will no longer echo to the console window"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{cmdWindow&&cmdWindow.cls&&cmdWindow.cls()}catch(e){console.log("command exception:"),console.dir(e)}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.commands={help:function(){return"List available commands from /bin to stdout\n\n  Usage: commands"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{wash("ls /bin")}catch(e){d?d.write("command exception: "+e):(console.log("command exception:"),console.dir(e))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.echo={help:function(){return"Echo string to stdout\n\n  Usage: echo [string]"},exec:function(a){var b=!1,c=this.fd&&this.fd.length>0?this.fd[0]:!1,d=this.fd&&this.fd.length>1?this.fd[1]:!1,e=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var f=a instanceof Array?f=a.join(" "):a;d?d.write(f):console.log(f);if(b&&e)throw new Error("fake error")}catch(g){e?e.write("command exception: "+g):(console.log("command exception:"),console.dir(g))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.edit={help:function(){return"Edit file in File Editor\n\n  Usage: edit [filepath]\n\nNOTE: This command is currently tied to the temporary File Editor window."},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=a[0];e.match(/^\//)||(e=system.env.cwd+"/"+e),editWindow&&($("#"+editWindow.name+"-filename").val(e),editWindow.load(e),$("#"+editWindow.name).show())}catch(f){d?d.write("command exception: "+f):(console.log("command exception:"),console.dir(f))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.help={help:function(){return"Simple help utility\n\n  Usage: help [command name]"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=a instanceof Array?a[0]:"help";if(system.bin[e]){var f='Help not available for command "'+e+'"';system.bin[e].help&&(f=system.bin[e].help()),c&&c.write(f)}}catch(g){d?d.write("command exception: "+g):(console.log("command exception:"),console.dir(g))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.ls={help:function(){return"List files\n\n  Usage: ls [-l] [path]\n\nWithout a path, lists the current working directory.\nWith -l, lists files in a single column."},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1,e=function(a,b){var c=a;while(c.length<b)c+=" ";return c};try{var f="wide",g=system.env.cwd;a instanceof Array&&(g=a.shift(),g.match(/^-l/)&&(f="single",g=a.shift(),g||(g=system.env.cwd)));var h=g+":"+"\n";f=="wide"&&(h+="\n");var i=system.fs.getFolder(g);if(i){var j=i.listFiles(),k=0;for(var l=0;l<j.length;l++)j[l].path.length>k&&(k=j[l].path.length);var m=0;for(var l=0;l<j.length;l++){var n=j[l].path,o=j[l].file,p=o&&o.tree?"/":"";switch(f){case"single":h+="  "+n+p+"\n";break;case"wide":default:var q=e(n+p,k+1)+"  ";m>60&&(h+="\n",m=0),m+=q.length,h+=q}}h=h.replace(/\n$/,"")}else h="folder not found";c?c.write(h):console.log(h)}catch(r){console.log("command exception:"),console.dir(r)}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.mkdir={help:function(){return"Make directory\n\n  Usage: mkdir [folder name]\n\nNOTE: This command is currently limited to creating folders in the current directory"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=!1,f=a instanceof Array?a.shift():a,g=system.fs.getFolder(system.env.cwd);g&&(e=g.addChildFolder(f));var h=e?"ok, created ":"failed to create ";c&&c.write(h+f)}catch(i){d?d.write("command exception: "+i):(console.log("command exception:"),console.dir(i))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.pwd={help:function(){return"Echo current working directory to stdout\n\n  Usage: pwd"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{c?c.write(system.env.cwd):console.log(system.env.cwd)}catch(e)
{console.log("command exception:"),console.dir(e)}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.rm={help:function(){return"Remove a file\n\n  Usage: rm [filename]\n\nNOTE: This command is currently limited to removing files in the current directory"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=!1,f=a instanceof Array?a.shift():a,g=system.fs.getFolder(system.env.cwd);g&&(e=g.removeFile(f));var h=e?"ok, removed ":"failed to remove ";c&&c.write(h+f)}catch(i){d?d.write("command exception: "+i):(console.log("command exception:"),console.dir(i))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.rmdir={help:function(){return"Remove a directory\n\n  Usage: rmdir [folder name]\n\nNOTE: This command is currently limited to removing folders in the current directory"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=!1,f=a instanceof Array?a.shift():a,g=system.fs.getFolder(system.env.cwd);g&&(e=g.removeChildFolder(f));var h=e?"ok, removed ":"failed to remove ";c&&c.write(h+f)}catch(i){d?d.write("command exception: "+i):(console.log("command exception:"),console.dir(i))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.tcl={help:function(){return"Run a tcl command and print the result \n\n  Usage: tcl [string]"},exec:function(a){var b=!1,c=this.fd&&this.fd.length>0?this.fd[0]:!1,d=this.fd&&this.fd.length>1?this.fd[1]:!1,e=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var f=a instanceof Array?f=a.join(" "):a,g="",h;if(f.match(/^< /)){g=f.replace(/^< /,"");var i=system.fs.readFile(g);h=tcl(i)}else h=tcl(f);h&&h.content&&d.write(h.content)}catch(j){e?e.write("command exception: "+j):(console.log("command exception:"),console.dir(j))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.touch={help:function(){return"Create empty file\n\n  Usage: touch [file name]\n\nNOTE: This command is currently limited to creating files in the current directory"},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{var e=!1,f=a instanceof Array?a.shift():a,g=system.env.cwd;f.match(/^\//)&&(g=f,f=system.fs.basename(g));var h=system.fs.getFolder(g);h&&(e=h.addFile(f));var i=e?"ok, created ":"failed to create ";c&&c.write(i+'file "'+f+'"')}catch(j){d?d.write("command exception: "+j):(console.log("command exception:"),console.dir(j))}}},window.system=window.system||{},system.bin=system.bin||{},system.bin.wallpaper={help:function(){return'Sets the desktop wallpaper\n\n  Usage: wallpaper\n\nThis command can currently only add/remove one graphic [css class="bg-tile"]'},exec:function(a){var b=this.fd&&this.fd.length>0?this.fd[0]:!1,c=this.fd&&this.fd.length>1?this.fd[1]:!1,d=this.fd&&this.fd.length>2?this.fd[2]:!1;try{dObj=system.fs.tree.mnt.tree.desktop,dName=dObj.name,dEl=$("#"+dName),dEl.hasClass("bg-tile")?dEl.removeClass("bg-tile"):dEl.addClass("bg-tile")}catch(e){d?d.write("command exception: "+e):(console.log("command exception:"),console.dir(e))}}};var HxNETDevice=HxDevice.extend({init:function(a){this.url=a.url||"",this.pollRate=a.pollRate||0,this.buffer="",this._super(a);var b=this;this.url!=""&&this.pollRate>999&&setTimeout(function(a){a.poll()},this.pollRate,this)},send:function(a,b){$.ajax({url:this.url,async:!1,type:"POST",data:a,success:b,error:this.error})},poll:function(){console.warn("HxNETDevice polling");var a={cmd:"time"};this.send(a,function(a){console.warn("HxNETDevice received: "+a)}),this.url!=""&&this.pollRate>999&&setTimeout(function(a){a.poll()},this.pollRate,this)},error:function(a){console.warn("HxNETDevice: Error: "+a.statusText+" ["+a.status+"]")}});window.system={debug:!0,bin:system.bin||{},bus:system.bus?system.bus:HxBus?HxBus:{},env:{},fs:new HxJSFS({name:"/",tree:{bin:new HxJSFS({name:"/bin",tree:{}}),dev:new HxJSFS({name:"/dev",tree:{net:new HxNETDevice({name:"/dev/net",url:"net-example/netdevice.php",pollRate:6e4})}}),etc:new HxJSFS({name:"/etc",tree:{motd:new HxFile({name:"/etc/motd",buffer:"Welcome to Atomic OS 2"})}}),home:new HxJSFS({name:"/home",tree:{guest:new HxJSFS({name:"/home/guest",tree:{readme:new HxFile({name:"/home/guest/readme",buffer:"Lorem ipsum and all that jazz."}),data:new HxJSFS({name:"/home/guest/data",tree:{readme:new HxFile({name:"/home/guest/data/settings",buffer:"# Sample config"})}})}})}}),lib:new HxJSFS({name:"/lib",tree:{}}),mnt:new HxJSFS({name:"/mnt",tree:{}}),proc:new HxPROCFS({name:"/proc",tree:{}})}}),lib:system.lib||{},proc:{}};for(var cmd in system.bin)system.fs.tree.bin.tree[cmd]=new HxFile({name:"/bin/"+cmd,buffer:system.bin[cmd].exec.toString()});system=system||{},system.lib={registerProcess:function(a){console.warn("syslib: registering new process as "+a.name);var b=system.fs.getFolder("/proc"),c=b.addChildFolder(a.name);c?(c.name="/proc/"+a.name,c.addFile("stdin",a.fd[0].name),c.addFile("stdout",a.fd[1].name),c.addFile("stderr",a.fd[2].name)):console.warn("process folder not found!")}},$(document).ready(function(){console.log("System starting... this is main"),$("body").append('<div id="winroot"></div><div id="fileroot"></div>'),console.log("Setting up environment"),system.env={home:"/home/guest",cwd:"/home/guest",pwd:"/",mobile:navigator.userAgent.match(/mobile/i)||navigator.userAgent.match(/fennec/i)?!0:!1},console.log("Loading init process (wash)"),system.proc.wash=new HxWash,window.wash=function(a){system.proc.wash.exec.call(system.proc.wash,a)},console.log("Creating netfs");var a=new HxNETFS({name:"/mnt/remote",tree:{}});system.fs.mount("/mnt",a);var b=system.fs.tree.mnt.tree.remote instanceof HxNETFS?"[ OK ]":"[FAIL]";console.log("Mount netfs "+b),console.log("Creating domfs");var c=new HxDOMFS({name:"/mnt/dom",tree:{}}),d=$(".domfile");for(var e=0;e<d.length;e++){var f="/mnt/dom/",g=d[e].id;g="/"+g.replace(/-/g,"/");var h=system.fs.basename(g);g?f=g:f+=e,c.tree[h]=new HxFile({name:f,buffer:d[e].textContent})}system.fs.mount("/mnt",c);var b=system.fs.tree.mnt.tree.dom instanceof HxJSFS?"[ OK ]":"[FAIL]";console.log("Mount domfs "+b),console.log("Creating desktop");var i=new HxPanel({name:"/mnt/desktop",css:{position:"absolute",top:0,left:0,right:0,bottom:0,border:"0px solid #000",backgroundColor:"rgba(127,192,127,0.9)",borderRadius:"0px",mozBorderRadius:"0px"},tree:{}});system.fs.mount("/mnt",i),b=system.fs.tree.mnt.tree.desktop instanceof HxJSFS?"[ OK ]":"[FAIL]",console.log("Mount desktop "+b),$("#desktop").append('<div class="taskbar"></div>'),console.log("Sharing global stdout"),system.proc.wash.fd[1].autoFlush=!1,console.log("Creating UI");var j="1%",k="48%";system.env.mobile&&(j="1%",k="98%"),window.cmdWindow=new HxCommandWindow({parentEl:"desktop",mount:"/mnt/desktop",title:"Command Console",defaultStyle:!1,css:{top:"40px",left:j,width:k,bottom:"3%",position:"absolute",backgroundColor:"#fff",border:"2px outset #ddd"},inputHandler:function(a){system.proc.wash.fd[0].write(a)},outputHandler:function(){var a=system.proc.wash.fd[1].read()+"\n",b=$("#"+cmdWindow.name+"-output");b.append(a),b[0].scrollTop=b[0].scrollHeight},errorHandler:function(){}});var l=system.proc.wash.fd[1];l.bus.subscribe(l.name+":ondata",cmdWindow.outputHandler),$(".taskbar").append('<button id="cmdwin-taskbtn" class="ui-btn-pressed">Console</button>'),$("#cmdwin-taskbtn").click(function(){$("#"+cmdWindow.name).toggle("hide"),this.className=this.className.match(/ui-btn-pressed/)?"ui-btn":"ui-btn-pressed"});var m=j;window.editWindow=new HxEditWindow({parentEl:"desktop",mount:"/mnt/desktop",title:"File Editor",defaultStyle:!0,css:{top:"40px",right:m,width:k,bottom:"3%"},intputHandler:function(a){},outputHandler:function(){},errorHandler:function(){}}),$(".taskbar").append('<button id="editwin-taskbtn" class="ui-btn-pressed">Editor</button>'),$("#editwin-taskbtn").click(function(){$("#"+editWindow.name).toggle("hide"),this.className=this.className.match(/ui-btn-pressed/)?"ui-btn":"ui-btn-pressed"}),window.docWindow=new HxDocWindow({parentEl:"desktop",mount:"/mnt/desktop",title:"Documentation",defaultStyle:!0,css:{top:40,left:0,right:0,bottom:"3%"}}),$(".taskbar").append('<button id="docwin-taskbtn" class="ui-btn-pressed">Docs</button>'),$("#docwin-taskbtn").click(function(){$("#"+docWindow.name).toggle("hide"),this.className=this.className.match(/ui-btn-pressed/)?"ui-btn":"ui-btn-pressed"}),$("#editwin-taskbtn")[0].click(),$("#docwin-taskbtn")[0].click(),console.log("Starting tcl"),system.proc.tcl=new HxTcl,window.tcl=function(a){return system.proc.tcl.exec.call(system.proc.tcl,a)},console.log("Startup complete."),wash("cat /mnt/dom/motd")})